<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>登录页面</title>
    <link href="../css/login.css" type="text/css" rel="stylesheet" />
    <link rel="stylesheet" href="../assets/bootstrap-3.3.7-dist/css/bootstrap.css">
    <link rel="stylesheet" href="../css/base.css">
    <script src="../lib/jquery-1.10.1.min.js"></script>
    <script src="../js/common.js"></script>
</head>

<body>
    <section id="hlogin">
        <div id="hlogo"><img src="../images/hlogo.jpg" alt=""></div>
        <p id="hh1">后台管理系统</p>
        <div class="form-group htx1">
            <input type="text" class="form-control" id="username" placeholder="用户名">
        </div>
        <div class="form-group htx2">
            <input type="password" class="form-control" id="password" placeholder="密码">
        </div>
        <div class="form-group htx3">
            <input type="text" class="form-control" id="yzm" placeholder="图形验证码">
        </div>
        <span id="random"></span>
        <div class="checkbox">
            <label>
                <input type="checkbox">
                <p id="hp1">记住密码</p>
            </label>
            <span id="hwj">忘记密码?</span>
        </div>
        <div id="hlbtn" class="btn btn-success btnLogin">登录</div>
    </section>
    <script>
        $(function () {
            $('#random').html(randomCode());
            $('#random').css('background', randomColor(16));
            $('#random').on('click', function () {
                $('#random').css('background', randomColor(16));
                $('#random').html(randomCode());
            })
        });

        (() => {

            let username = document.querySelector('#username');
            let password = document.querySelector('#password');
            // let mdl = document.querySelector('#mdl');
            let btnLogin = document.querySelector('.btnLogin');
            let yzm = document.querySelector('#yzm');
            let random = document.querySelector('#random');

            btnLogin.onclick = (e) => {
                let _username = username.value.trim();
                let _password = password.value.trim();
                let _yzm = yzm.value.toLowerCase();
                let _random = random.innerHTML.toLowerCase();
                // console.log(_yzm, _random);
                // let _mdl = mdl.checked;
                if (_yzm == _random) {
                    if (_username && _password) {
                        let xhr = new XMLHttpRequest();
                        xhr.onload = () => {

                            if (xhr.status == 200) {
                                let res = JSON.parse(xhr.responseText);
                                // console.log(res);
                                if (res) {
                                    location.href = '../index.html';
                                }
                                else {
                                    alert('用户名或密码错误');
                                }
                            }
                        }
                        xhr.open('post', '/login', true);
                        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
                        let data = `username=${_username}&password=${_password}`
                        xhr.send(data);

                        e.preventDefault();
                    }
                    else {
                        alert('用户名或密码不能为空');
                    }
                }
                else {
                    alert('验证码不正确')
                }
                // 发起ajax请求

            }
        })();
    </script>
</body>

</html>